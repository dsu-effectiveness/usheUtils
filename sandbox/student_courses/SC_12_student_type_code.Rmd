---
title: "SC-12 Student Type Code"
author: "Craig Demke"
date: '2022-07-11'
output: html_document
---


```{r set global chunks, include=FALSE}
knitr::opts_chunk$set(
  warning = FALSE, message = FALSE
)
```

```{r load libraries}
library(tidyverse)
library(datasets)
library(plotly)
library(gt)
library(glue)
library(stringr)
library(DT)
library(purrr)
library(here)
```
### This is part of the 
* 

### This data is found in Edify from 
```{}

```


### Create fake data that matches this.

```{r}
placeholder_test_df <- tibble(
  latest_student_type = sample(c("H"), 10, replace = TRUE),
  #section_number = sample(c("12345"), 10, replace = TRUE),
  #subject_code = sample(c("PSY"), 10, replace = TRUE),
  #course_id = sample(c("PSY-1010"), 10, replace = TRUE),
  season = sample(c("spring"), 10, replace = TRUE),
  budget_code = sample(c("SF", "BA", "BC"), 10, replace = TRUE)
  field = sample(c("conc", ""), 10, replace = TRUE)
)

DT::datatable(placeholder_test_df, rownames=FALSE)
```

### Now let's see if we can pull in real data

```{r}
### We pull the data we want from the report database REPT 

placeholder_real_df <- utHelpR::get_data_from_sql_file(file_name="placeholder.sql",
                                               dsn="edify",
                                               context="sandbox")

# display data pulled in table
DT::datatable(placeholder_real_df, rownames=FALSE)
```


### Here is the R script

The first thing I need to do is to figure out how to

```{r}

change_placeholder_df <- placeholder_test_df %>%
mutate(c_dest_site = if_else(high_school_code == '459500' |
                               high_school_code =='459600'|
                               high_school_code =='459998'|
                               high_school_code =='969999'|
                               high_school_code =='459150'|
                               high_school_code =='459300'|
                               high_school_code =='459200'), "EC",
                         if_else((budget_code == "BC" | budget_code == "SF") & field == conc, "CC",
                         if_else((budget_code == "BC" | budget_code == "SF") & field != conc, "DC"))
)
    # Append USHE data element s_xx
    mutate( s_xx = paste0(intermediate_field_1, intermediate_field_2) )
  # budget_code != "BC | "SF"
    
    


DT::datatable(change_placeholder_df, rownames=FALSE)



```

### Making a function

```{r}
  
format_placeholder <- function(input_df, with_intermediates=FALSE) {

  output_df <- input_df %>%
    # Calculate intermediate fields
    mutate( intermediate_field_1 = "1") %>%
    mutate( intermediate_field_2 = "2") %>%
    # Append USHE data element s_xx
    mutate( s_xx = paste0(intermediate_field_1, intermediate_field_2) )

    if (!with_intermediates) {
      output_df <- output_df %>%
        # Remove fields used for intermediate calculations
        select( -c(intermediate_field_1, intermediate_field_2) )
    }

  return(output_df)

  
}
```
### Choose which data frame you want pass through the function 

placeholder_test_df for the fake data set
```{r}
DT::datatable(format_placeholder(placeholder_test_df), rownames=FALSE)
```

placeholder_real_df for the real data
```{r}
DT::datatable(format_placeholder(placeholder_real_df), rownames=FALSE)
```

